# Plan Dev - 开发任务执行计划

## 命令用途

根据 PRD（产品需求文档）执行开发任务，确保开发过程遵循项目规范，并保持代码与文档的一致性。

**核心原则：**

- **先测试后开发**：开发前先编写测试用例文档，明确验收标准
- **规范先行**：严格遵守项目开发规范（代码风格、架构模式、命名约定等）
- **文档同步**：开发完成后同步更新相关技术文档和设计文档，确保文档与实现一致

## 使用方式

```
/plan-dev <PRD文档路径>
```

示例：

```
/plan-dev docs/prd/repository-architecture-storage-and-analysis-prd.md
/plan-dev docs/prd/todo-1-smart-repository-filtering-prd.md
```

---

## 执行流程

### 第一步：理解 PRD 内容

在开始开发前，仔细阅读并理解 PRD：

- 读取完整的 PRD 文档
- 识别功能需求、技术需求、API 规范、UI 交互规范等关键信息
- 明确目标、成功标准、验收检查清单
- 识别依赖关系和与其他模块的交互点
- 理解风险评估和技术可行性说明

### 第二步：分析项目上下文

了解项目中与本次开发相关的现有实现：

- 查看相关代码文件，理解现有实现方式和设计模式
- 识别需要修改的现有模块、组件、服务
- 确认可复用的组件、工具函数、类型定义
- 了解项目使用的技术栈版本和依赖
- 检查是否有相关的测试文件和测试规范

### 第三步：编写测试用例文档

**在开始编码之前**，必须先编写测试用例文档：

- 根据 PRD 中的验收检查清单，提取可测试的行为和规则
- 编写测试用例文档，保存到 `docs/test-cases/` 目录
- 测试用例应包括：
  - 功能测试用例（正常流程）
  - 边界条件测试用例
  - 错误处理测试用例
  - 集成测试用例（如适用）
- 参考 `create-unit-test.md` 命令生成单元测试代码（如适用）

**输出要求：**

- 测试用例文档路径：`docs/test-cases/{功能名称}-test-cases.md`
- 确保测试用例覆盖 PRD 中的验收检查清单

### 第四步：制定开发计划

根据 PRD 和项目上下文，制定详细的开发计划：

- 将功能拆分为可执行的任务步骤
- 明确每个步骤的输入、输出和依赖关系
- 识别开发风险和需要提前解决的问题
- 确定开发顺序（优先实现依赖项，再实现依赖方）
- 列出需要创建/修改的文件清单

**开发计划结构：**

```markdown
## 开发任务清单

### 后端任务

- [ ] 任务 1：实现 XXX API
- [ ] 任务 2：创建数据库迁移
- [ ] 任务 3：更新服务层逻辑

### 前端任务

- [ ] 任务 1：创建 XXX 组件
- [ ] 任务 2：实现 XXX Hook
- [ ] 任务 3：更新页面路由

### 测试任务

- [ ] 任务 1：编写单元测试
- [ ] 任务 2：编写集成测试
```

### 第五步：执行开发

按照开发计划逐步实现功能，严格遵守项目规范：

**后端开发规范：**

- 遵循 Hono API 设计模式（参考 `.cursor/rules/api-design-patterns.mdc`）
- 使用依赖注入，避免全局依赖
- 服务层代码保持纯业务逻辑，无框架特定代码
- 使用类型安全的 API 响应类型
- 正确处理错误和边界情况

**前端开发规范：**

- 遵循命名约定（组件 PascalCase、Hooks kebab-case、工具文件 kebab-case）
- 使用 SWR 进行服务器状态管理，Zustand 进行客户端状态管理
- 使用类型安全的 API 客户端（`apiGet`、`apiPost` 等）
- 组件 props 使用 PascalCase + `Props` 后缀
- 事件处理器使用 `handle` 前缀
- 遵循 React Router 模式（不使用 Next.js 特性）

**代码质量要求：**

- 避免使用 `any` 类型，使用明确的类型定义
- 使用共享类型定义，不重复定义类型
- 保持代码简洁，遵循"约定优于配置"原则
- 添加必要的注释和文档字符串

### 第六步：代码审查与测试

开发完成后，进行自我审查和测试：

- 运行测试用例，确保所有测试通过
- 检查代码是否符合项目规范（命名、结构、类型等）
- 验证功能是否符合 PRD 中的验收检查清单
- 检查是否有遗漏的边缘情况和错误处理
- 确认与依赖模块的交互正确

### 第七步：同步文档

**开发完成后必须同步更新相关文档**，确保文档与实现一致：

**需要更新的文档类型：**

1. **技术文档**（如适用）：

   - API 文档：更新 API 端点说明、请求/响应示例
   - 架构文档：更新系统架构图、模块说明
   - 数据库文档：更新数据模型、迁移说明

2. **设计文档**（如适用）：

   - UI/UX 设计文档：更新组件说明、交互流程
   - 流程图：更新业务流程、数据流程图

3. **README 文档**（如适用）：

   - 更新项目 README 中的功能列表
   - 更新环境变量说明
   - 更新部署说明

4. **测试文档**：
   - 更新测试用例执行结果
   - 记录已知问题和限制

**文档更新要求：**

- 所有与实现相关的变更必须反映到文档中
- 保持文档结构清晰，使用一致的格式
- 添加必要的代码示例和截图（如适用）
- 标记文档更新日期和版本号

### 第八步：输出与总结

完成所有步骤后，输出开发总结：

1. **功能完成情况**：

   - 列出已完成的功能点
   - 说明未完成的部分（如有）及原因

2. **测试执行情况**：

   - 测试用例执行结果
   - 测试覆盖率情况

3. **文档更新情况**：

   - 列出已更新的文档文件
   - 说明文档变更内容

4. **后续工作**（如适用）：
   - 待优化的点
   - 待解决的技术债务
   - 后续迭代建议

---

## 质量检查清单

在完成开发后，确保以下所有项已检查：

### ✅ PRD 覆盖度

- [ ] 所有功能需求已实现
- [ ] 所有验收标准已达成
- [ ] API 规范已完全实现（如适用）
- [ ] UI 交互规范已完全实现（如适用）

### ✅ 代码规范

- [ ] 命名约定正确（文件命名、变量命名、函数命名）
- [ ] 类型定义完整，无 `any` 类型滥用
- [ ] 代码结构符合项目架构模式
- [ ] 无违反项目规范的代码

### ✅ 测试覆盖

- [ ] 测试用例文档已编写
- [ ] 单元测试已编写并全部通过
- [ ] 集成测试已编写并全部通过（如适用）
- [ ] 边界条件和错误处理已测试

### ✅ 文档同步

- [ ] 技术文档已更新
- [ ] 设计文档已更新
- [ ] README 已更新（如适用）
- [ ] 所有文档内容与实现一致

---

## 注意事项

1. **严格遵守顺序**：必须按照"先测试用例文档，再开发，最后同步文档"的顺序执行
2. **规范优先**：遇到不确定的地方，优先参考项目规范文档（`.cursor/rules/`）
3. **文档同步是必须的**：开发完成后必须同步文档，不能跳过
4. **类型安全**：始终使用类型安全的 API 客户端和类型定义
5. **代码简洁**：遵循"约定优于配置"和"最小化代码复杂度"原则
