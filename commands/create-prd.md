# Create PRD - 产品需求文档生成器

## 命令用途

根据用户提供的需求描述，生成结构完整的产品需求文档（PRD）。

## 使用方式

```
/create-prd <需求描述>
```

示例：

```
/create-prd 实现用户认证功能，支持 OAuth2 和手机验证码登录，需要与现有用户系统集成
```

---

## 执行流程

### 第一步：分析项目上下文

**在理解用户需求前，先主动获取项目背景信息：**

1. **分析项目结构**

   - 查看项目的 `package.json`、`README.md` 等文件，了解项目类型、技术栈
   - 浏览项目目录结构，理解现有模块划分

2. **分析现有功能**

   - 查看相关代码文件，理解现有实现方式和设计模式
   - 识别与新需求相关的现有模块、组件、接口

3. **识别约束与依赖**

   - 了解项目使用的框架、库版本
   - 发现与新需求可能产生交互的现有功能

4. **技术可行性初判**
   - 基于项目现状，初步判断需求的技术可行性
   - 识别可能需要引入的新依赖或技术方案

### 第二步：评估需求完整性

基于项目上下文，评估用户需求描述是否充分：

**必要信息（缺失则必须询问）：**

- 功能目标：要解决什么问题？
- 目标用户：谁会使用这个功能？
- 核心场景：用户的主要使用流程是什么？

**重要信息（模糊则建议澄清）：**

- 成功标准：如何判断功能做好了？
- 优先级：哪些是必须的，哪些是可选的？
- 特殊约束：有哪些业务上的限制或特殊要求？

**可选信息（缺失可用合理默认值）：**

- 风险评估
- 边界情况处理

### 第三步：补充第一方信息（仅在必要时）

如果需求描述已足够完整，直接进入下一步。

如果信息不足，**一次性**列出所有需要补充的问题，并结合项目上下文给出合理的默认建议。

### 第四步：外部参考调研（在第一方信息充分后执行）

> 目标：在“已获得足够的第一方需求信息 + 项目背景信息”之后，主动吸收**外部成熟经验**，避免闭门造车，提升方案质量与可信度。

**调研范围（按需选择，优先高相关 + 可验证来源）：**

1. **竞品/同类产品**：同类功能的交互细节、默认策略、边界处理、商业化策略（免费/付费分层）、引导与教育。
2. **类似场景的成熟方案**：开源项目、知名产品/平台、社区公认模式（例如“草稿/发布”、“审批流”、“配额/计费”、“权限模型”等）。
3. **行业最佳实践**：安全、合规、隐私、可观测性、可用性、性能、无障碍、国际化等领域的通用准则。
4. **最新技术进展**：相关框架/协议/标准的新特性、已废弃能力、推荐替代方案、生态工具链演进。

**调研方法（确保可落地，而不是信息堆砌）：**

- **明确检索假设**：本需求最关键的不确定点是什么？（例如“用户心智”“默认值策略”“风控”“可扩展性”）
- **对比维度统一**：用同一张对比表对齐不同方案（见下方“产出要求”）。
- **证据优先级**：官方文档/标准 > 一线产品公开说明 > 高质量工程实践文章 > 零散观点。
- **结论必须回扣到本项目约束**：技术栈、成本、团队能力、交付周期、合规要求。

**产出要求（会被写入 PRD）：**

- **外部参考摘要**：3–7 条高信噪结论（每条说明“结论是什么 / 为什么 / 对本项目的启示”）。
- **方案对比表**：至少 2 个可行方案，包含优缺点、风险、成本、适配度。
- **推荐方案与决策理由**：明确“为什么选它”，以及“什么时候需要改选/升级方案”。
- **引用与链接**：列出关键来源（能追溯、可复查）。

### 第五步：信息汇总与方案定稿

在输出 PRD 前，先把信息聚合为可执行决策：

- **需求澄清结论**：目标/范围/成功标准/约束的最终表述
- **关键决策点**：每个决策点给出备选方案、推荐方案、理由与权衡
- **风险与对策**：按“发生概率 × 影响”排序，给出可执行缓解措施

### 第六步：生成 PRD 文档

信息充分后，按照下方模板生成完整 PRD：

- 已知信息直接填入
- 结合项目上下文补充技术可行性说明
- 确实缺失的标注为 `[待补充]`

### 第七步：输出与确认

生成后：

1. 输出完整 PRD 文档
2. 列出标注为 `[待补充]` 的部分（如有）
3. 询问是否需要调整或补充

---

## PRD 文档模板

```markdown
# PRD: {功能名称}

| 属性     | 值       |
| -------- | -------- |
| 版本     | 1.0      |
| 状态     | 草稿     |
| 创建日期 | {DATE}   |
| 作者     | [待补充] |

---

## 1. 概述

### 1.1 背景

[业务背景和动机]

### 1.2 问题描述

[要解决的问题]

### 1.3 解决方案概述

[方案整体思路]

---

## 2. 目标与指标

### 2.1 目标

| 编号 | 目标     | 优先级   |
| ---- | -------- | -------- |
| G1   | [目标 1] | 必须实现 |
| G2   | [目标 2] | 应该实现 |

### 2.2 非目标

- [本次不做的事情]

### 2.3 成功标准

| 标准     | 描述   | 验证方式 |
| -------- | ------ | -------- |
| [标准 1] | [描述] | [方式]   |

---

## 3. 用户分析

### 3.1 目标用户

| 用户类型 | 特征   | 核心需求 |
| -------- | ------ | -------- |
| [用户 1] | [描述] | [需求]   |

### 3.2 用户旅程

1. **入口** → [用户从哪里开始]
2. **操作** → [用户执行什么动作]
3. **结果** → [用户得到什么反馈]

---

## 4. 用户故事

### US-1: {故事标题}

**作为** [用户类型]
**我想要** [执行的操作]
**以便** [获得的价值]

**验收标准：**

- [ ] [标准 1]
- [ ] [标准 2]

**优先级：** [必须/应该/可以]

---

## 5. 功能需求

| 编号 | 需求描述 | 优先级   | 备注 |
| ---- | -------- | -------- | ---- |
| F1   | [需求 1] | 必须实现 |      |
| F2   | [需求 2] | 应该实现 |      |

### F1: {功能名称}

- **描述：** [详细描述]
- **输入：** [输入内容]
- **输出：** [输出内容]
- **异常处理：** [边界情况]

---

## 6. UI 交互规范

> **重要**：每个可交互元素必须明确三态规则，避免前端实现遗漏。

### 6.1 UI 状态矩阵

对于每个按钮/控件，必须明确以下三个状态：

| 元素名称   | 可见条件              | 可用条件           | 文案/样式变化规则                      |
| ---------- | --------------------- | ------------------ | -------------------------------------- |
| [按钮名称] | [什么用户/状态下可见] | [什么条件下可点击] | [不同状态下的文案/样式]                |
| 示例       | 仅 Pro 用户可见       | 未达每日限制时可用 | 可用时显示"执行"，限制时显示"明天可用" |

### 6.2 状态流转图
```

[初始状态] → [触发条件] → [目标状态]
↓
[异常分支] → [错误状态] → [恢复操作] → [初始状态]

````

### 6.3 加载与反馈

| 操作       | 加载态表现       | 成功反馈         | 失败反馈         |
| ---------- | ---------------- | ---------------- | ---------------- |
| [操作名称] | [loading 样式]   | [toast/UI 变化]  | [错误提示]       |

---

## 7. API 规范

### 7.1 接口定义

#### `[METHOD] /api/xxx`

- **认证：** Required / Optional
- **权限：** 所有用户 / Pro 用户 / Admin

**Request Body:**

```typescript
{
  field1: string;
  field2?: number;
}
````

**Response:**

```typescript
{
  success: boolean;
  data: {
    // 必须列出所有前端需要的字段
    field1: string;
    field2: number;
  };
  error?: string;
}
```

**错误码：**

| HTTP Status | 错误场景 | Response                                    |
| ----------- | -------- | ------------------------------------------- |
| 400         | 参数错误 | `{ error: "Invalid input" }`                |
| 401         | 未登录   | `{ error: "Unauthorized" }`                 |
| 403         | 权限不足 | `{ error: "Forbidden" }`                    |
| 429         | 频率限制 | `{ error: "...", nextAvailableAt: number }` |

### 7.2 前端所需字段清单

> **关键**：明确列出前端 UI 渲染所需的每个字段，避免后端实现但前端不知道用。

| 字段名            | 类型    | 用途               | 来源 API        |
| ----------------- | ------- | ------------------ | --------------- |
| `canDoAction`     | boolean | 控制按钮是否可点击 | GET /api/status |
| `nextAvailableAt` | number  | 显示下次可用时间   | GET /api/status |

---

## 8. 依赖与集成

### 8.1 PRD 依赖关系

> **重要**：明确与其他 PRD 的交互点，避免跨功能遗漏。

| 依赖 PRD | 交互点               | 本 PRD 职责         | 依赖方职责         |
| -------- | -------------------- | ------------------- | ------------------ |
| PRD-XX   | [共享的数据/接口/UI] | [本 PRD 需要做什么] | [依赖方需要做什么] |

### 8.2 现有系统分析

- **相关现有模块：** [列出相关的现有代码模块]
- **可复用组件：** [可以复用的现有组件/服务]
- **需要修改的部分：** [需要调整的现有功能]

### 8.3 技术依赖

| 依赖项   | 类型      | 说明       |
| -------- | --------- | ---------- |
| [依赖 1] | 现有/新增 | [影响说明] |

---

## 9. 技术可行性

### 9.1 技术方案概述

[简要说明实现思路，确认技术上可行]

### 9.2 数据模型

[涉及的数据表/字段变更]

---

## 10. 验收检查清单

> **重要**：开发完成后必须逐项检查，避免实现遗漏。

### 10.1 后端检查项

- [ ] 所有 API 端点已实现
- [ ] API 响应包含前端所需的全部字段
- [ ] 权限检查正确（用户类型、配额限制）
- [ ] 错误码和错误信息符合规范
- [ ] 数据库变更已迁移

### 10.2 前端检查项

- [ ] 所有 UI 元素的三态（可见/可用/文案）已正确实现
- [ ] 不同用户类型看到的 UI 符合预期
- [ ] 操作后正确刷新相关数据（mutate/revalidate）
- [ ] 加载状态、成功反馈、错误提示已实现
- [ ] 限制状态下的 UI 表现正确（禁用 + 提示）

### 10.3 集成检查项

- [ ] 与依赖 PRD 的交互点已正确对接
- [ ] 数据流完整（API → Hook → 组件 → UI）

---

## 11. 风险评估

| 风险     | 可能性   | 影响     | 应对措施 |
| -------- | -------- | -------- | -------- |
| [风险 1] | 高/中/低 | 高/中/低 | [措施]   |

---

## 12. 附录

### 外部参考与方案对比（建议保留）

> 目标：把外部信息转化为“可落地的选择”，并保留可追溯证据。

#### 外部参考摘要

- [结论 1]（来源：xxx）
- [结论 2]（来源：xxx）

#### 备选方案对比

| 方案 | 适用场景 | 优点 | 缺点/风险 | 实现成本 | 与现有系统适配度 | 备注 |
| ---- | -------- | ---- | --------- | -------- | ---------------- | ---- |
| A    |          |      |           |          |                  |      |
| B    |          |      |           |          |                  |      |

#### 推荐方案与决策记录

- **推荐方案**：A / B
- **选择理由**：[为什么]
- **不选原因**：[为什么不选其他方案]
- **后续演进**：[何时需要升级/替换方案]

### 术语表

| 术语     | 定义   |
| -------- | ------ |
| [术语 1] | [定义] |

### 变更记录

| 版本 | 日期   | 变更内容 |
| ---- | ------ | -------- |
| 1.0  | {DATE} | 初稿     |

````

---

## 可选扩展

如果用户明确要求输出技术指标，可在 PRD 中增加以下章节：

```markdown
## [可选] 技术指标

### 性能要求

| 指标     | 目标值             |
| -------- | ------------------ |
| 响应时间 | [根据业务需求填写] |
| 并发支持 | [根据业务需求填写] |

### 可用性要求

| 指标 | 目标值             |
| ---- | ------------------ |
| SLA  | [根据业务需求填写] |

### 安全要求

| 项目     | 要求               |
| -------- | ------------------ |
| 认证方式 | [根据业务需求填写] |
| 数据保护 | [根据业务需求填写] |
````

---

## 输出位置

建议保存到：`/docs/prd/{功能名称}-prd.md`

## 语言规范

- 文档内容使用中文
- 技术术语、代码、变量名保留英文

---

## PRD 质量检查要点

在生成 PRD 时，确保以下关键点已覆盖：

### ✅ 避免前端实现遗漏

1. **每个按钮/控件都有明确的三态定义**（可见/可用/文案）
2. **API 响应字段与 UI 需求对齐**（前端需要什么字段，后端就返回什么）
3. **操作后的数据刷新明确**（哪些缓存需要更新）

### ✅ 避免后端实现遗漏

1. **所有错误场景有对应的错误码**
2. **权限和配额限制有明确的检查逻辑**
3. **返回的字段能支持 UI 的所有状态展示**

### ✅ 避免跨功能遗漏

1. **依赖其他 PRD 的交互点有明确说明**
2. **涉及多页面的功能有统一的状态来源**
3. **共享数据的变更通知机制明确**

### ✅ 避免闭门造车（外部参考必备）

1. **完成外部参考调研并形成可追溯来源**（竞品/成熟方案/最佳实践/技术进展）
2. **至少 2 个方案做过对比**（而不是只写一个“拍脑袋方案”）
3. **推荐方案的权衡清晰**（成本、风险、适配度、演进路径）
