# Create PRD - 产品需求文档生成器

## 命令用途

根据用户提供的需求描述，通过内置知识库和外部竞品校验，帮助用户完善需求定义、界定需求边界，生成**适配需求类型和复杂度**的产品需求文档（PRD），避免下游执行环节遗漏或理解偏差。

**核心原则：**

- **按需生成**：根据需求类型（前端/后端/全栈/简单功能）动态选择 PRD 结构
- **避免冗余**：前端需求不包含数据库设计和 API 设计，后端需求不包含交互设计和前端状态管理
- **保持完整**：确保需求边界清晰，避免执行遗漏

## 使用方式

```
/create-prd <需求描述>
```

示例：

```
/create-prd 实现用户认证功能，支持 OAuth2 和手机验证码登录，需要与现有用户系统集成
/create-prd 优化移动端 Git Insights 页面的桑基图展示，改为表格形式
/create-prd 调整 AI 分析配额逻辑，移除每日频次限制
```

---

## 执行流程

### 第一步：分析项目上下文

在理解用户需求前，先主动获取项目背景信息：

- 查看 `package.json`、`README.md` 等，了解项目类型、技术栈
- 浏览项目目录结构，理解现有模块划分
- 查看相关代码文件，理解现有实现方式和设计模式
- 识别与新需求相关的现有模块、组件、接口
- 了解项目使用的框架、库版本
- 初步判断需求的技术可行性和需要引入的新依赖

### 第二步：需求类型与复杂度分析

在生成 PRD 前，先判断需求类型和复杂度，以选择合适的模板结构。

#### 2.1 需求类型识别

| 需求类型       | 特征                                              | 示例                                             |
| -------------- | ------------------------------------------------- | ------------------------------------------------ |
| **纯前端需求** | 只涉及 UI/交互/前端状态，不涉及后端逻辑或数据变更 | "优化移动端展示"、"添加按钮动画"、"调整页面布局" |
| **纯后端需求** | 只涉及 API/服务/数据库，不涉及前端界面            | "优化查询性能"、"调整配额逻辑"、"新增数据迁移"   |
| **全栈需求**   | 同时涉及前端和后端，需要前后端协作                | "实现用户认证"、"新增分享功能"、"实现 AI 分析"   |
| **简单功能**   | 单一、明确、范围小的功能点                        | "修改按钮文案"、"调整错误提示"、"优化加载状态"   |

#### 2.2 复杂度评估

根据功能范围、技术难度、影响范围、依赖关系评估：

- **简单**：单一功能点，影响范围小，无复杂依赖
- **中等**：涉及多个模块，需要前后端协作，有一定技术难度
- **复杂**：架构级变更，影响全局，依赖多个系统

#### 2.3 模板选择决策

根据需求类型和复杂度，选择对应的 PRD 模板：

| 需求类型 | 复杂度    | 模板章节                                                                             |
| -------- | --------- | ------------------------------------------------------------------------------------ |
| 纯前端   | 简单      | 概述、目标、用户故事、UI 交互规范、验收清单                                          |
| 纯前端   | 中等/复杂 | 概述、目标、用户故事、功能需求、UI 交互规范、依赖与集成、验收清单                    |
| 纯后端   | 简单      | 概述、目标、用户故事、API 规范（如涉及）、技术可行性、验收清单                       |
| 纯后端   | 中等/复杂 | 概述、目标、用户故事、功能需求、API 规范、数据模型、依赖与集成、技术可行性、验收清单 |
| 全栈     | 任意      | 完整模板（所有章节）                                                                 |
| 简单功能 | 任意      | 简化模板（概述、目标、功能需求、验收清单）                                           |

**决策规则：**

1. **前端需求** → 不包含：API 规范、数据模型、数据库设计
2. **后端需求** → 不包含：UI 交互规范、前端状态管理、交互设计
3. **简单功能** → 只包含核心章节，省略详细设计
4. **全栈需求** → 包含所有章节

### 第三步：评估需求完整性

基于项目上下文和需求类型，评估用户需求描述是否充分：

- **必要信息**（缺失则必须询问）：功能目标、目标用户（前端需求必须）、核心场景（前端需求必须）
- **重要信息**（模糊则建议澄清）：成功标准、优先级、特殊约束
- **可选信息**（缺失可用合理默认值）：风险评估（复杂需求必须）、边界情况处理（中等以上复杂度必须）

### 第四步：补充第一方信息（仅在必要时）

如果需求描述已足够完整，直接进入下一步。

如果信息不足，**一次性**列出所有需要补充的问题，并结合项目上下文给出合理的默认建议。

### 第五步：外部参考调研（在第一方信息充分后执行）

在第一方需求信息充分后，主动吸收外部成熟经验，避免闭门造车。

**调研范围（按需选择）：**

- 竞品/同类产品：交互细节、默认策略、边界处理、商业化策略
- 类似场景的成熟方案：开源项目、知名产品、社区公认模式
- 行业最佳实践：安全、合规、性能、可用性等通用准则
- 最新技术进展：相关框架/协议的新特性、推荐替代方案

**产出要求：**

- 外部参考摘要：3–7 条高信噪结论（结论/原因/启示）
- 方案对比表：至少 2 个可行方案，包含优缺点、风险、成本、适配度（复杂需求必须）
- 推荐方案与决策理由（复杂需求必须）
- 引用与链接：列出关键来源

**注意：** 简单功能可省略外部参考调研，或仅做简要说明。

### 第六步：信息汇总与方案定稿

在输出 PRD 前，把信息聚合为可执行决策：

- 需求澄清结论：目标/范围/成功标准/约束的最终表述
- 关键决策点：备选方案、推荐方案、理由与权衡（复杂需求必须）
- 风险与对策：按"发生概率 × 影响"排序，给出缓解措施（中等以上复杂度必须）

### 第七步：生成 PRD 文档

根据第二步的模板选择决策，生成对应结构的 PRD：

- 已知信息直接填入
- 结合项目上下文补充技术可行性说明
- 确实缺失的标注为 `[待补充]`
- 只包含与需求类型相关的章节

### 第八步：输出与确认

生成后：

1. 输出完整 PRD 文档
2. 列出标注为 `[待补充]` 的部分（如有）
3. 说明选择的模板类型和理由
4. 询问是否需要调整或补充

---

## PRD 文档模板

> **重要**：根据第二步的"需求类型与复杂度分析"，选择对应的模板章节。**只包含与需求类型相关的章节**，避免冗余。

### 模板章节说明

| 章节             | 纯前端 | 纯后端 | 全栈 | 简单功能 | 说明                     |
| ---------------- | ------ | ------ | ---- | -------- | ------------------------ |
| 1. 概述          | ✅     | ✅     | ✅   | ✅       | 必需                     |
| 2. 目标与指标    | ✅     | ✅     | ✅   | ✅       | 必需                     |
| 3. 用户分析      | ✅     | ❌     | ✅   | ❌       | 前端需求必需             |
| 4. 用户故事      | ✅     | ✅     | ✅   | ✅       | 必需                     |
| 5. 功能需求      | 中等+  | 中等+  | ✅   | ✅       | 简单功能可合并到用户故事 |
| 6. UI 交互规范   | ✅     | ❌     | ✅   | 按需     | 前端需求必需             |
| 7. API 规范      | ❌     | ✅     | ✅   | 按需     | 后端需求必需             |
| 8. 依赖与集成    | 中等+  | 中等+  | ✅   | ❌       | 有依赖时必需             |
| 9. 技术可行性    | 中等+  | ✅     | ✅   | ❌       | 后端需求必需             |
| 10. 验收检查清单 | ✅     | ✅     | ✅   | ✅       | 必需                     |
| 11. 风险评估     | 中等+  | 中等+  | ✅   | ❌       | 中等以上复杂度必需       |
| 12. 附录         | 中等+  | 中等+  | ✅   | ❌       | 有外部参考时必需         |

**符号说明：**

- ✅ = 必需包含
- ❌ = 不包含
- 中等+ = 中等以上复杂度包含
- 按需 = 根据具体情况决定

---

### 完整模板（全栈需求）

```markdown
# PRD: {功能名称}

| 属性     | 值                        |
| -------- | ------------------------- |
| 版本     | 1.0                       |
| 状态     | 草稿                      |
| 创建日期 | {DATE}                    |
| 作者     | [待补充]                  |
| 需求类型 | [前端/后端/全栈/简单功能] |
| 复杂度   | [简单/中等/复杂]          |

---

## 1. 概述

### 1.1 背景

[业务背景和动机]

### 1.2 问题描述

[要解决的问题]

### 1.3 解决方案概述

[方案整体思路]

---

## 2. 目标与指标

### 2.1 目标

| 编号 | 目标     | 优先级   |
| ---- | -------- | -------- |
| G1   | [目标 1] | 必须实现 |
| G2   | [目标 2] | 应该实现 |

### 2.2 非目标

- [本次不做的事情]

### 2.3 成功标准

| 标准     | 描述   | 验证方式 |
| -------- | ------ | -------- |
| [标准 1] | [描述] | [方式]   |

---

## 3. 用户分析

> **注意**：纯后端需求可省略此章节。

### 3.1 目标用户

| 用户类型 | 特征   | 核心需求 |
| -------- | ------ | -------- |
| [用户 1] | [描述] | [需求]   |

### 3.2 用户旅程

1. **入口** → [用户从哪里开始]
2. **操作** → [用户执行什么动作]
3. **结果** → [用户得到什么反馈]

---

## 4. 用户故事

### US-1: {故事标题}

**作为** [用户类型]
**我想要** [执行的操作]
**以便** [获得的价值]

**验收标准：**

- [ ] [标准 1]
- [ ] [标准 2]

**优先级：** [必须/应该/可以]

---

## 5. 功能需求

> **注意**：简单功能可省略此章节，直接在用户故事中描述。

| 编号 | 需求描述 | 优先级   | 备注 |
| ---- | -------- | -------- | ---- |
| F1   | [需求 1] | 必须实现 |      |
| F2   | [需求 2] | 应该实现 |      |

### F1: {功能名称}

- **描述：** [详细描述]
- **输入：** [输入内容]
- **输出：** [输出内容]
- **异常处理：** [边界情况]

---

## 6. UI 交互规范

> **注意**：纯后端需求不包含此章节。

> **重要**：每个可交互元素必须明确三态规则，避免前端实现遗漏。

### 6.1 UI 状态矩阵

对于每个按钮/控件，必须明确以下三个状态：

| 元素名称   | 可见条件              | 可用条件           | 文案/样式变化规则                      |
| ---------- | --------------------- | ------------------ | -------------------------------------- |
| [按钮名称] | [什么用户/状态下可见] | [什么条件下可点击] | [不同状态下的文案/样式]                |
| 示例       | 仅 Pro 用户可见       | 未达每日限制时可用 | 可用时显示"执行"，限制时显示"明天可用" |

### 6.2 状态流转图
```

[初始状态] → [触发条件] → [目标状态]
↓
[异常分支] → [错误状态] → [恢复操作] → [初始状态]

````

### 6.3 加载与反馈

| 操作       | 加载态表现       | 成功反馈         | 失败反馈         |
| ---------- | ---------------- | ---------------- | ---------------- |
| [操作名称] | [loading 样式]   | [toast/UI 变化]  | [错误提示]       |

---

## 7. API 规范

> **注意**：纯前端需求不包含此章节。

### 7.1 接口定义

#### `[METHOD] /api/xxx`

- **认证：** Required / Optional
- **权限：** 所有用户 / Pro 用户 / Admin

**Request Body:**

```typescript
{
  field1: string;
  field2?: number;
}
````

**Response:**

```typescript
{
  success: boolean;
  data: {
    // 必须列出所有前端需要的字段
    field1: string;
    field2: number;
  };
  error?: string;
}
```

**错误码：**

| HTTP Status | 错误场景 | Response                                    |
| ----------- | -------- | ------------------------------------------- |
| 400         | 参数错误 | `{ error: "Invalid input" }`                |
| 401         | 未登录   | `{ error: "Unauthorized" }`                 |
| 403         | 权限不足 | `{ error: "Forbidden" }`                    |
| 429         | 频率限制 | `{ error: "...", nextAvailableAt: number }` |

### 7.2 前端所需字段清单

> **关键**：明确列出前端 UI 渲染所需的每个字段，避免后端实现但前端不知道用。

| 字段名            | 类型    | 用途               | 来源 API        |
| ----------------- | ------- | ------------------ | --------------- |
| `canDoAction`     | boolean | 控制按钮是否可点击 | GET /api/status |
| `nextAvailableAt` | number  | 显示下次可用时间   | GET /api/status |

---

## 8. 依赖与集成

> **注意**：简单功能或无依赖时可省略此章节。

### 8.1 PRD 依赖关系

> **重要**：明确与其他 PRD 的交互点，避免跨功能遗漏。

| 依赖 PRD | 交互点               | 本 PRD 职责         | 依赖方职责         |
| -------- | -------------------- | ------------------- | ------------------ |
| PRD-XX   | [共享的数据/接口/UI] | [本 PRD 需要做什么] | [依赖方需要做什么] |

### 8.2 现有系统分析

- **相关现有模块：** [列出相关的现有代码模块]
- **可复用组件：** [可以复用的现有组件/服务]
- **需要修改的部分：** [需要调整的现有功能]

### 8.3 技术依赖

| 依赖项   | 类型      | 说明       |
| -------- | --------- | ---------- |
| [依赖 1] | 现有/新增 | [影响说明] |

---

## 9. 技术可行性

> **注意**：纯前端简单功能可省略此章节。

### 9.1 技术方案概述

[简要说明实现思路，确认技术上可行]

### 9.2 数据模型

> **注意**：纯前端需求不包含此部分。

[涉及的数据表/字段变更]

---

## 10. 验收检查清单

> **重要**：开发完成后必须逐项检查，避免实现遗漏。

### 10.1 后端检查项

> **注意**：纯前端需求可省略此部分。

- [ ] 所有 API 端点已实现
- [ ] API 响应包含前端所需的全部字段
- [ ] 权限检查正确（用户类型、配额限制）
- [ ] 错误码和错误信息符合规范
- [ ] 数据库变更已迁移

### 10.2 前端检查项

> **注意**：纯后端需求可省略此部分。

- [ ] 所有 UI 元素的三态（可见/可用/文案）已正确实现
- [ ] 不同用户类型看到的 UI 符合预期
- [ ] 操作后正确刷新相关数据（mutate/revalidate）
- [ ] 加载状态、成功反馈、错误提示已实现
- [ ] 限制状态下的 UI 表现正确（禁用 + 提示）

### 10.3 集成检查项

- [ ] 与依赖 PRD 的交互点已正确对接
- [ ] 数据流完整（API → Hook → 组件 → UI）

---

## 11. 风险评估

> **注意**：简单功能可省略此章节。

| 风险     | 可能性   | 影响     | 应对措施 |
| -------- | -------- | -------- | -------- |
| [风险 1] | 高/中/低 | 高/中/低 | [措施]   |

---

## 12. 附录

> **注意**：简单功能或无外部参考时可省略此章节。

### 12.1 外部参考与方案对比

> 目标：把外部信息转化为"可落地的选择"，并保留可追溯证据。

#### 外部参考摘要

- [结论 1]（来源：xxx）
- [结论 2]（来源：xxx）

#### 备选方案对比

| 方案 | 适用场景 | 优点 | 缺点/风险 | 实现成本 | 与现有系统适配度 | 备注 |
| ---- | -------- | ---- | --------- | -------- | ---------------- | ---- |
| A    |          |      |           |          |                  |      |
| B    |          |      |           |          |                  |      |

#### 推荐方案与决策记录

- **推荐方案**：A / B
- **选择理由**：[为什么]
- **不选原因**：[为什么不选其他方案]
- **后续演进**：[何时需要升级/替换方案]

### 12.2 术语表

| 术语     | 定义   |
| -------- | ------ |
| [术语 1] | [定义] |

### 12.3 变更记录

| 版本 | 日期   | 变更内容 |
| ---- | ------ | -------- |
| 1.0  | {DATE} | 初稿     |

````

---

### 简化模板示例（简单功能）

简单功能（如"修改按钮文案"、"调整错误提示"）可使用以下简化结构：

```markdown
# PRD: {功能名称}

| 属性     | 值       |
| -------- | -------- |
| 版本     | 1.0      |
| 状态     | 草稿     |
| 创建日期 | {DATE}   |
| 需求类型 | 简单功能 |
| 复杂度   | 简单     |

---

## 1. 概述

### 1.1 背景
[简要说明背景]

### 1.2 问题描述
[要解决的问题]

### 1.3 解决方案概述
[简要方案]

---

## 2. 目标与指标

### 2.1 目标
| 编号 | 目标     | 优先级   |
| ---- | -------- | -------- |
| G1   | [目标 1] | 必须实现 |

### 2.2 成功标准
| 标准     | 描述   | 验证方式 |
| -------- | ------ | -------- |
| [标准 1] | [描述] | [方式]   |

---

## 3. 用户故事

### US-1: {故事标题}

**作为** [用户类型]
**我想要** [执行的操作]
**以便** [获得的价值]

**验收标准：**
- [ ] [标准 1]
- [ ] [标准 2]

**实现说明：**
[简要说明实现方式，如涉及 UI 则说明具体位置和文案]

---

## 4. 验收检查清单

- [ ] [检查项 1]
- [ ] [检查项 2]

---

## 5. 变更记录

| 版本 | 日期   | 变更内容 |
| ---- | ------ | -------- |
| 1.0  | {DATE} | 初稿     |

````

---

## 可选扩展

如果用户明确要求输出技术指标，可在 PRD 中增加以下章节：

```markdown
## [可选] 技术指标

### 性能要求

| 指标     | 目标值             |
| -------- | ------------------ |
| 响应时间 | [根据业务需求填写] |
| 并发支持 | [根据业务需求填写] |

### 可用性要求

| 指标 | 目标值             |
| ---- | ------------------ |
| SLA  | [根据业务需求填写] |

### 安全要求

| 项目     | 要求               |
| -------- | ------------------ |
| 认证方式 | [根据业务需求填写] |
| 数据保护 | [根据业务需求填写] |
```

---

## 输出位置与规范

- **保存位置**：`/docs/prd/{YYYY-MM-DD}-{功能名称}-prd.md`（日期格式：YYYY-MM-DD，例如：2024-01-15）
- **语言规范**：文档内容使用中文，技术术语、代码、变量名保留英文

---

## PRD 质量检查要点

在生成 PRD 时，确保以下关键点已覆盖：

### ✅ 模板选择正确性

- 需求类型判断准确（前端/后端/全栈/简单功能）
- 复杂度评估合理（简单/中等/复杂）
- 模板章节选择正确（只包含相关章节，避免冗余）
- 在 PRD 头部明确标注需求类型和复杂度

### ✅ 避免实现遗漏

**前端需求/全栈需求：**

- 每个按钮/控件都有明确的三态定义（可见/可用/文案）
- API 响应字段与 UI 需求对齐
- 操作后的数据刷新明确（哪些缓存需要更新）
- 用户旅程清晰（入口 → 操作 → 结果）

**后端需求/全栈需求：**

- 所有错误场景有对应的错误码
- 权限和配额限制有明确的检查逻辑
- 返回的字段能支持 UI 的所有状态展示
- 数据模型设计合理

**中等以上复杂度：**

- 依赖其他 PRD 的交互点有明确说明
- 涉及多页面的功能有统一的状态来源
- 共享数据的变更通知机制明确
- 完成外部参考调研并形成可追溯来源
- 至少 2 个方案做过对比（复杂需求必须）
- 推荐方案的权衡清晰（成本、风险、适配度、演进路径）

### ✅ 需求边界清晰

- 目标与非目标明确
- 成功标准可验证
- 验收清单完整
- 简单功能使用简化模板，避免过度设计
